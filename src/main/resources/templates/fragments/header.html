<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<header th:fragment="header">
    <style>
        .main-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
            font-size: 28px;
            font-weight: bold;
            transition: transform 0.3s;
        }

        .header-logo:hover {
            transform: scale(1.05);
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-user-info {
            color: white;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-btn {
            padding: 10px 24px;
            border: 2px solid white;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .header-btn-login {
            background: transparent;
            color: white;
        }

        .header-btn-login:hover {
            background: white;
            color: #667eea;
        }

        .header-btn-register {
            background: white;
            color: #667eea;
        }

        .header-btn-register:hover {
            background: transparent;
            color: white;
        }

        .header-btn-admin {
            background: #ffc107;
            color: #333;
            border: 2px solid #ffc107;
        }

        .header-btn-admin:hover {
            background: #ffb300;
            border-color: #ffb300;
        }

        .header-btn-logout {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
        }

        .header-btn-logout:hover {
            background: #dc3545;
            border-color: #dc3545;
        }

        .admin-badge {
            background: #ffc107;
            color: #333;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }
    </style>

    <div class="main-header">
        <a th:href="@{/}" class="header-logo">
            <span>üìö</span>
            <span>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–Ω–∏–≥</span>
        </a>

        <nav class="header-nav" id="headerNav">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </nav>
    </div>

    <script th:inline="javascript">
        const AuthUtils = {
            getToken() {
                return localStorage.getItem('jwt_token');
            },

            setToken(token) {
                localStorage.setItem('jwt_token', token);
            },

            removeToken() {
                localStorage.removeItem('jwt_token');
                localStorage.removeItem('user_nickname');
                localStorage.removeItem('user_email');
                localStorage.removeItem('user_role');
            },

            isAuthenticated() {
                return !!this.getToken();
            },

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏–∑ localStorage
            getUserInfo() {
                const token = this.getToken();
                if (!token) return null;

                return {
                    nickname: localStorage.getItem('user_nickname') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    email: localStorage.getItem('user_email') || '',
                    role: localStorage.getItem('user_role') || 'USER'
                };
            },

            isAdmin() {
                const userInfo = this.getUserInfo();
                if (!userInfo) return false;

                const role = userInfo.role;


                return role === 'ADMIN' || role === 'ROLE_ADMIN';
            }
        };

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ header
        function renderHeader() {
            const headerNav = document.getElementById('headerNav');

            if (AuthUtils.isAuthenticated()) {
                const userInfo = AuthUtils.getUserInfo();

                if (!userInfo) {
                    // –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
                    headerNav.innerHTML = `
                        <a href="/login" class="header-btn header-btn-login">–í—Ö–æ–¥</a>
                        <a href="/register" class="header-btn header-btn-register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    `;
                    return;
                }

                const isAdmin = AuthUtils.isAdmin();


                let adminBadge = isAdmin ? '<span class="admin-badge">ADMIN</span>' : '';
                let adminButton = isAdmin ? '<a href="/admin" class="header-btn header-btn-admin">‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>' : '';

                const displayName = userInfo.nickname || userInfo.email || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';

                headerNav.innerHTML = `
                    <div class="header-user-info">
                        <span>üë§ ${displayName}${adminBadge}</span>
                    </div>
                    ${adminButton}
                    <button class="header-btn header-btn-logout" onclick="logout()">–í—ã–π—Ç–∏</button>
                `;
            } else {
                headerNav.innerHTML = `
                    <a href="/login" class="header-btn header-btn-login">–í—Ö–æ–¥</a>
                    <a href="/register" class="header-btn header-btn-register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                `;
            }
        }

        async function logout() {
            const token = AuthUtils.getToken();

            try {
                await fetch('/proxy/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', e);
            } finally {
                AuthUtils.removeToken();
                window.location.href = '/';
            }
        }

        document.addEventListener('DOMContentLoaded', renderHeader);
    </script>


</header>
</body>
</html>
